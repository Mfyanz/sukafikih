<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Pengetahuan Haji</title>
  <meta name="description" content="Uji pengetahuan Anda tentang ibadah haji dengan quiz interaktif ini">
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Configure Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f7ff',
              100: '#e0efff',
              200: '#bae0ff',
              300: '#7cc6ff',
              400: '#36a9ff',
              500: '#0090ff',
              600: '#0072e6',
              700: '#005db3',
              800: '#004c99',
              900: '#003a75',
            }
          },
          animation: {
            'bounce-slow': 'bounce 2s infinite',
            'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8fafc;
    }
    
    .option-card {
      transition: all 0.3s ease;
    }
    
    .option-card:hover {
      transform: translateY(-3px);
    }
    
    .option-card.selected {
      border-color: #0090ff;
      background-color: #e0efff;
    }
    
    .option-card.correct {
      border-color: #10b981;
      background-color: #d1fae5;
    }
    
    .option-card.incorrect {
      border-color: #ef4444;
      background-color: #fee2e2;
    }
    
    .progress-bar {
      transition: width 0.5s ease;
    }
    
    @keyframes countdown {
      from { width: 100%; }
      to { width: 0%; }
    }
    
    .timer-bar {
      animation: countdown 15s linear forwards;
    }
    
    .score-animation {
      animation: scorePopup 0.5s ease-out;
    }
    
    @keyframes scorePopup {
      0% { transform: scale(0.5); opacity: 0; }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #0090ff;
      opacity: 0;
    }
    
    /* Enhanced animations for correct/incorrect answers */
    @keyframes correctPulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
    }
    
    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-10px); }
      40% { transform: translateX(10px); }
      60% { transform: translateX(-10px); }
      80% { transform: translateX(10px); }
    }
    
    .option-card.correct-animation {
      animation: correctPulse 0.8s ease-in-out;
    }
    
    .option-card.incorrect-animation {
      animation: incorrectShake 0.5s ease-in-out;
    }
    
    /* Feedback icons */
    .feedback-icon {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .option-card.correct .feedback-icon.correct-icon,
    .option-card.incorrect .feedback-icon.incorrect-icon {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="min-h-screen flex flex-col">
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="flex flex-col items-center justify-center min-h-screen p-4">
      <div class="max-w-md w-full bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="bg-primary-600 p-6 text-white text-center">
          <h1 class="text-2xl md:text-3xl font-bold">Quiz Pengetahuan Haji</h1>
          <p class="mt-2 opacity-90">Uji pengetahuan Anda tentang ibadah haji</p>
        </div>
        
        <div class="p-6">
          <div class="mb-6">
            <p class="text-gray-700 mb-4">Selamat datang di Quiz Pengetahuan Haji! Anda akan menjawab 10 pertanyaan tentang ibadah haji. Setiap pertanyaan memiliki batas waktu 15 detik.</p>
            
            <div class="bg-primary-50 p-4 rounded-lg mb-4">
              <h3 class="font-semibold text-primary-700 mb-2">Cara Bermain:</h3>
              <ul class="text-gray-700 space-y-1 text-sm">
                <li class="flex items-start">
                  <span class="text-primary-500 mr-2">•</span>
                  <span>Jawab 10 pertanyaan pilihan ganda</span>
                </li>
                <li class="flex items-start">
                  <span class="text-primary-500 mr-2">•</span>
                  <span>Setiap pertanyaan bernilai 10 poin</span>
                </li>
                <li class="flex items-start">
                  <span class="text-primary-500 mr-2">•</span>
                  <span>Jawaban cepat mendapatkan bonus poin</span>
                </li>
                <li class="flex items-start">
                  <span class="text-primary-500 mr-2">•</span>
                  <span>Waktu habis = tidak mendapat poin</span>
                </li>
              </ul>
            </div>
            
            <div class="mb-6">
              <label for="player-name" class="block text-sm font-medium text-gray-700 mb-1">Nama Anda (opsional):</label>
              <input type="text" id="player-name" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500" placeholder="Masukkan nama Anda">
            </div>
          </div>
          
          <button id="start-quiz" class="w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center">
            <span>Mulai Quiz</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Quiz Screen -->
    <div id="quiz-screen" class="flex-1 p-4 hidden">
      <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-4">
          <div class="flex justify-between items-center mb-2">
            <div class="flex items-center">
              <div class="bg-primary-600 text-white p-2 rounded-md mr-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
                </svg>
              </div>
              <h2 class="text-lg font-semibold text-gray-800">Quiz Pengetahuan Haji</h2>
            </div>
            <div class="flex items-center">
              <div class="text-sm font-medium text-gray-600 mr-2">Skor:</div>
              <div id="score-display" class="bg-primary-100 text-primary-800 font-semibold px-3 py-1 rounded-full">0</div>
            </div>
          </div>
          
          <!-- Progress Bar -->
          <div class="w-full bg-gray-200 rounded-full h-2.5 mb-1">
            <div id="progress-bar" class="bg-primary-600 h-2.5 rounded-full progress-bar" style="width: 10%"></div>
          </div>
          <div class="flex justify-between text-xs text-gray-500">
            <div id="question-counter">Pertanyaan 1 dari 10</div>
            <div id="time-bonus">Bonus waktu: +5</div>
          </div>
        </div>
        
        <!-- Question Card -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-4">
          <!-- Timer Bar -->
          <div class="w-full bg-gray-200 h-1.5">
            <div id="timer-bar" class="bg-primary-600 h-1.5 timer-bar"></div>
          </div>
          
          <div class="p-6">
            <h3 id="question-text" class="text-xl font-semibold text-gray-800 mb-6">Apa pengertian dari ibadah haji?</h3>
            
            <div id="options-container" class="grid grid-cols-1 gap-3">
              <!-- Options will be inserted here by JavaScript -->
            </div>
            
            <!-- Feedback Message -->
            <div id="answer-feedback" class="mt-4 p-3 rounded-lg text-center hidden">
              <!-- Feedback will be inserted here by JavaScript -->
            </div>
          </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="flex justify-between">
          <button id="prev-question" class="bg-white text-primary-700 font-medium py-2 px-4 rounded-lg border border-primary-300 hover:bg-primary-50 transition-colors hidden">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110-2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
              </svg>
              <span>Sebelumnya</span>
            </div>
          </button>
          
          <button id="next-question" class="bg-primary-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <div class="flex items-center">
              <span>Selanjutnya</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </div>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Results Screen -->
    <div id="results-screen" class="flex-1 p-4 hidden">
      <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="bg-primary-600 p-6 text-white text-center">
            <h2 class="text-2xl font-bold mb-1">Quiz Selesai!</h2>
            <p class="opacity-90">Berikut adalah hasil quiz Anda</p>
          </div>
          
          <div class="p-6">
            <!-- Score Circle -->
            <div class="flex justify-center mb-6">
              <div class="relative">
                <svg class="w-48 h-48">
                  <circle cx="96" cy="96" r="88" fill="none" stroke="#e0efff" stroke-width="16" />
                  <circle id="score-circle" cx="96" cy="96" r="88" fill="none" stroke="#0090ff" stroke-width="16" stroke-dasharray="553" stroke-dashoffset="553" transform="rotate(-90 96 96)" />
                </svg>
                <div class="absolute inset-0 flex flex-col items-center justify-center score-animation">
                  <div id="final-score" class="text-5xl font-bold text-primary-700">0</div>
                  <div class="text-gray-500">dari 100</div>
                </div>
              </div>
            </div>
            
            <!-- Performance Stats -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div class="bg-primary-50 rounded-lg p-4 text-center">
                <div class="text-primary-700 font-semibold text-lg" id="correct-answers">0</div>
                <div class="text-gray-600 text-sm">Jawaban Benar</div>
              </div>
              <div class="bg-primary-50 rounded-lg p-4 text-center">
                <div class="text-primary-700 font-semibold text-lg" id="time-bonus-total">0</div>
                <div class="text-gray-600 text-sm">Bonus Waktu</div>
              </div>
            </div>
            
            <!-- Performance Message -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
              <h3 class="font-semibold text-gray-800 mb-2" id="performance-title">Hasil Evaluasi</h3>
              <p class="text-gray-700" id="performance-message">Anda telah menyelesaikan quiz dengan baik!</p>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-3">
              <button id="retry-quiz" class="flex-1 bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                Coba Lagi
              </button>
              <button id="share-results" class="flex-1 bg-white hover:bg-gray-50 text-primary-700 font-semibold py-3 px-6 rounded-lg border border-primary-300 transition-colors flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" />
                </svg>
                Bagikan Hasil
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Quiz data
      const quizData = [
        {
          question: "Apa pengertian dari ibadah haji?",
          options: [
            "Berkunjung ke Masjidil Haram kapan saja",
            "Mengunjungi tempat-tempat tertentu di Mekah pada waktu tertentu dengan niat beribadah",
            "Berziarah ke makam Nabi Muhammad SAW",
            "Melakukan perjalanan ke Madinah"
          ],
          correctAnswer: 1,
          explanation: "Haji adalah ibadah mengunjungi tempat-tempat tertentu di Mekah pada waktu tertentu (bulan Dzulhijjah) dengan niat beribadah dan memenuhi rukun-rukun tertentu."
        },
        {
          question: "Kapan waktu pelaksanaan ibadah haji?",
          options: [
            "Bulan Ramadhan",
            "Bulan Syawal",
            "Bulan Dzulhijjah",
            "Sepanjang tahun"
          ],
          correctAnswer: 2,
          explanation: "Ibadah haji dilaksanakan pada bulan Dzulhijjah, khususnya pada tanggal 8-13 Dzulhijjah setiap tahun."
        },
        {
          question: "Apa hukum melaksanakan ibadah haji bagi yang mampu?",
          options: [
            "Sunnah",
            "Wajib",
            "Mubah",
            "Makruh"
          ],
          correctAnswer: 1,
          explanation: "Hukum melaksanakan ibadah haji bagi yang mampu adalah wajib, sebagaimana disebutkan dalam Al-Quran Surat Ali Imran ayat 97."
        },
        {
          question: "Manakah yang termasuk rukun haji?",
          options: [
            "Memakai pakaian ihram",
            "Bermalam di Muzdalifah",
            "Wukuf di Arafah",
            "Melempar jumrah"
          ],
          correctAnswer: 2,
          explanation: "Wukuf di Arafah adalah salah satu rukun haji yang wajib dilaksanakan. Tanpa wukuf di Arafah, ibadah haji tidak sah."
        },
        {
          question: "Apa yang dimaksud dengan wukuf?",
          options: [
            "Berlari kecil antara bukit Shafa dan Marwah",
            "Berdiam diri di padang Arafah pada tanggal 9 Dzulhijjah",
            "Melempar batu ke tiang jumrah",
            "Mengelilingi Ka'bah sebanyak 7 kali"
          ],
          correctAnswer: 1,
          explanation: "Wukuf adalah berdiam diri di padang Arafah pada tanggal 9 Dzulhijjah, mulai dari tergelincirnya matahari hingga terbenamnya matahari."
        },
        {
          question: "Apa yang dimaksud dengan sa'i?",
          options: [
            "Berjalan atau berlari-lari kecil antara Shafa dan Marwah",
            "Melempar batu ke tiang jumrah",
            "Mengelilingi Ka'bah sebanyak 7 kali",
            "Bermalam di Mina"
          ],
          correctAnswer: 0,
          explanation: "Sa'i adalah berjalan atau berlari-lari kecil antara bukit Shafa dan Marwah sebanyak 7 kali, dimulai dari Shafa dan diakhiri di Marwah."
        },
        {
          question: "Berapa kali thawaf dilakukan dalam ibadah haji?",
        options: [
          "3 kali",
          "5 kali",
          "7 kali",
          "9 kali"
        ],
        correctAnswer: 2,
        explanation: "Thawaf dalam ibadah haji dilakukan sebanyak 7 kali putaran mengelilingi Ka'bah, dimulai dan diakhiri di Hajar Aswad."
      },
      {
        question: "Apa yang dimaksud dengan thawaf?",
        options: [
          "Berlari kecil antara bukit Shafa dan Marwah",
          "Berdiam diri di padang Arafah",
          "Melempar batu ke tiang jumrah",
          "Mengelilingi Ka'bah"
        ],
        correctAnswer: 3,
        explanation: "Thawaf adalah mengelilingi Ka'bah sebanyak 7 kali putaran dengan posisi Ka'bah berada di sebelah kiri dan dimulai dari Hajar Aswad."
      },
      {
        question: "Apa yang dimaksud dengan ihram dalam ibadah haji?",
        options: [
          "Pakaian khusus untuk ibadah haji",
          "Niat memulai ibadah haji atau umrah",
          "Larangan-larangan selama ibadah haji",
          "Semua jawaban benar"
        ],
        correctAnswer: 3,
        explanation: "Ihram mencakup tiga hal: pakaian khusus (untuk laki-laki berupa dua helai kain putih tidak berjahit), niat memulai ibadah, dan menjauhi larangan-larangan tertentu."
      },
      {
        question: "Manakah yang bukan termasuk syarat wajib haji?",
        options: [
          "Islam",
          "Baligh",
          "Berakal",
          "Sudah pernah umrah"
        ],
        correctAnswer: 3,
        explanation: "Syarat wajib haji adalah Islam, baligh (dewasa), berakal, merdeka, dan mampu (secara fisik, finansial, dan keamanan). Sudah pernah umrah bukan syarat wajib haji."
      }
    ];
    
    // Game variables
    let currentQuestion = 0;
    let score = 0;
    let selectedOption = null;
    let answeredQuestions = new Array(quizData.length).fill(false);
    let timeBonus = 0;
    let timeBonusTotal = 0;
    let timerInterval;
    let playerName = "";
    
    // Add this new variable to track user answers for each question
    let userAnswers = new Array(quizData.length).fill(null);
    
    // DOM Elements
    const welcomeScreen = document.getElementById('welcome-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultsScreen = document.getElementById('results-screen');
    const playerNameInput = document.getElementById('player-name');
    const startQuizBtn = document.getElementById('start-quiz');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const answerFeedback = document.getElementById('answer-feedback');
    const nextQuestionBtn = document.getElementById('next-question');
    const prevQuestionBtn = document.getElementById('prev-question');
    const progressBar = document.getElementById('progress-bar');
    const questionCounter = document.getElementById('question-counter');
    const scoreDisplay = document.getElementById('score-display');
    const timeBonusDisplay = document.getElementById('time-bonus');
    const timerBar = document.getElementById('timer-bar');
    const finalScore = document.getElementById('final-score');
    const scoreCircle = document.getElementById('score-circle');
    const correctAnswers = document.getElementById('correct-answers');
    const timeBonusTotalDisplay = document.getElementById('time-bonus-total');
    const performanceTitle = document.getElementById('performance-title');
    const performanceMessage = document.getElementById('performance-message');
    const retryQuizBtn = document.getElementById('retry-quiz');
    const shareResultsBtn = document.getElementById('share-results');
    
    // Initialize the quiz
    function startQuiz() {
      playerName = playerNameInput.value.trim();
      welcomeScreen.classList.add('hidden');
      quizScreen.classList.remove('hidden');
      loadQuestion();
    }
    
    // Load question and options
    function loadQuestion() {
      resetTimer();
      const question = quizData[currentQuestion];
      questionText.textContent = question.question;
      
      // Hide feedback message
      answerFeedback.classList.add('hidden');
      answerFeedback.innerHTML = '';
      
      // Update progress
      progressBar.style.width = `${((currentQuestion + 1) / quizData.length) * 100}%`;
      questionCounter.textContent = `Pertanyaan ${currentQuestion + 1} dari ${quizData.length}`;
      
      // Clear previous options
      optionsContainer.innerHTML = '';
      
      // Add options
      question.options.forEach((option, index) => {
        const optionCard = document.createElement('div');
        optionCard.className = 'option-card p-4 border border-gray-200 rounded-lg cursor-pointer hover:border-primary-300';
        optionCard.dataset.index = index;
        
        // If this question was already answered, show the correct/incorrect state
        if (answeredQuestions[currentQuestion]) {
          if (index === question.correctAnswer) {
            optionCard.classList.add('correct');
          } else if (index === userAnswers[currentQuestion] && index !== question.correctAnswer) {
            optionCard.classList.add('incorrect');
          }
        }
        
        // If this option was previously selected, mark it
        if (index === userAnswers[currentQuestion] && !answeredQuestions[currentQuestion]) {
          optionCard.classList.add('selected');
        }
        
        optionCard.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center mr-3 flex-shrink-0">
                <span class="text-sm font-medium">${String.fromCharCode(65 + index)}</span>
              </div>
              <span>${option}</span>
            </div>
            <div class="flex-shrink-0">
              <!-- Correct icon -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500 feedback-icon correct-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
              </svg>
              <!-- Incorrect icon -->
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 feedback-icon incorrect-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </div>
          </div>
        `;
        
        optionCard.addEventListener('click', () => selectOption(index));
        optionsContainer.appendChild(optionCard);
      });
      
      // Update button states
      updateButtonStates();
      
      // Start timer if question not answered yet
      if (!answeredQuestions[currentQuestion]) {
        startTimer();
      } else {
        // Disable option selection
        const options = document.querySelectorAll('.option-card');
        options.forEach(option => {
          option.style.cursor = 'default';
          option.removeEventListener('click', selectOption);
        });
        
        // Show explanation if answered
        showExplanation();
      }
    }
    
    // Select an option
    function selectOption(index) {
      // If already answered, do nothing
      if (answeredQuestions[currentQuestion]) return;
      
      // Clear previous selection
      const options = document.querySelectorAll('.option-card');
      options.forEach(option => option.classList.remove('selected'));
      
      // Mark new selection
      options[index].classList.add('selected');
      selectedOption = index;
      
      // Store the selected answer for this question
      userAnswers[currentQuestion] = index;
      
      // Enable next button
      nextQuestionBtn.disabled = false;
    }
    
    // Go to next question
    function goToNextQuestion() {
      // If no option selected, do nothing
      if (selectedOption === null && !answeredQuestions[currentQuestion]) return;
      
      // If not answered yet, check answer and update score
      if (!answeredQuestions[currentQuestion]) {
        checkAnswer();
      }
      
      // Move to next question or show results
      if (currentQuestion < quizData.length - 1) {
        currentQuestion++;
        selectedOption = null;
        loadQuestion();
      } else {
        showResults();
      }
    }
    
    // Go to previous question
    function goToPrevQuestion() {
      if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion();
      }
    }
    
    // Check answer and update score
    function checkAnswer() {
      clearInterval(timerInterval);
      
      const correctAnswerIndex = quizData[currentQuestion].correctAnswer;
      const options = document.querySelectorAll('.option-card');
      
      // Mark as answered
      answeredQuestions[currentQuestion] = true;
      
      // Show correct and incorrect options with enhanced animations
      options.forEach((option, index) => {
        if (index === correctAnswerIndex) {
          option.classList.add('correct');
          option.classList.add('correct-animation');
        } else if (index === userAnswers[currentQuestion] && index !== correctAnswerIndex) {
          option.classList.add('incorrect');
          option.classList.add('incorrect-animation');
        }
      });
      
      // Update score if correct
      if (userAnswers[currentQuestion] === correctAnswerIndex) {
        // Base score for correct answer
        const baseScore = 10;
        
        // Calculate time bonus (0-5 points)
        const remainingTimePercent = parseFloat(timerBar.style.width) || 0;
        timeBonus = Math.floor((remainingTimePercent / 100) * 5);
        
        // Update score
        score += baseScore + timeBonus;
        timeBonusTotal += timeBonus;
        
        // Update displays
        scoreDisplay.textContent = score;
        timeBonusDisplay.textContent = `Bonus waktu: +${timeBonus}`;
        
        // Add score animation
        scoreDisplay.classList.add('animate-pulse-fast');
        setTimeout(() => {
          scoreDisplay.classList.remove('animate-pulse-fast');
        }, 1000);
        
        // Show success feedback
        answerFeedback.innerHTML = `
          <div class="flex items-center justify-center text-green-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="font-medium">Jawaban Benar!</span>
          </div>
          <p class="text-gray-700 mt-2">${quizData[currentQuestion].explanation}</p>
        `;
    answerFeedback.className = "mt-4 p-3 rounded-lg text-center bg-green-50 border border-green-200";
  } else {
    timeBonus = 0;
    timeBonusDisplay.textContent = 'Bonus waktu: +0';
    
    // Show error feedback
    answerFeedback.innerHTML = `
      <div class="flex items-center justify-center text-red-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="font-medium">Jawaban Salah!</span>
      </div>
      <p class="text-gray-700 mt-2">Jawaban yang benar adalah: ${quizData[currentQuestion].options[correctAnswerIndex]}</p>
      <p class="text-gray-700 mt-2">${quizData[currentQuestion].explanation}</p>
    `;
    answerFeedback.className = "mt-4 p-3 rounded-lg text-center bg-red-50 border border-red-200";
  }
  
  answerFeedback.classList.remove('hidden');
  
  // Disable option selection
  options.forEach(option => {
    option.style.cursor = 'default';
    option.removeEventListener('click', selectOption);
  });
  
  // Update button text if last question
  if (currentQuestion === quizData.length - 1) {
    nextQuestionBtn.innerHTML = `
      <div class="flex items-center">
        <span>Lihat Hasil</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M6.672 1.911a1 1 0 10-1.932.518l.259.966a1 1 0 001.932-.518l-.26-.966zM2.429 4.74a1 1 0 10-.517 1.932l.966.259a1 1 0 00.517-1.932l-.966-.26zm8.814-.569a1 1 0 00-1.415-1.414l-.707.707a1 1 0 101.415 1.415l.707-.708zm-7.071 7.072l.707-.707A1 1 0 003.465 9.12l-.708.707a1 1 0 001.415 1.415zm3.2-5.171a1 1 0 00-1.3 1.3l4 10a1 1 0 001.823.075l1.38-2.759 3.018 3.02a1 1 0 001.414-1.415l-3.019-3.02 2.76-1.379a1 1 0 00-.076-1.822l-10-4z" clip-rule="evenodd" />
      </svg>
      </div>
    `;
  }
}

// Update the showExplanation function to use the stored answer
function showExplanation() {
  const correctAnswerIndex = quizData[currentQuestion].correctAnswer;
  
  if (userAnswers[currentQuestion] === correctAnswerIndex) {
    answerFeedback.innerHTML = `
      <div class="flex items-center justify-center text-green-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="font-medium">Jawaban Benar!</span>
      </div>
      <p class="text-gray-700 mt-2">${quizData[currentQuestion].explanation}</p>
    `;
    answerFeedback.className = "mt-4 p-3 rounded-lg text-center bg-green-50 border border-green-200";
  } else {
    answerFeedback.innerHTML = `
      <div class="flex items-center justify-center text-red-600">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="font-medium">Jawaban Salah!</span>
      </div>
      <p class="text-gray-700 mt-2">Jawaban yang benar adalah: ${quizData[currentQuestion].options[correctAnswerIndex]}</p>
      <p class="text-gray-700 mt-2">${quizData[currentQuestion].explanation}</p>
    `;
    answerFeedback.className = "mt-4 p-3 rounded-lg text-center bg-red-50 border border-red-200";
  }
  
  answerFeedback.classList.remove('hidden');
}

// Update the resetQuiz function to reset userAnswers
function resetQuiz() {
  // Reset game variables
  currentQuestion = 0;
  score = 0;
  selectedOption = null;
  answeredQuestions = new Array(quizData.length).fill(false);
  userAnswers = new Array(quizData.length).fill(null);
  timeBonus = 0;
  timeBonusTotal = 0;
  
  // Reset displays
  scoreDisplay.textContent = '0';
  timeBonusDisplay.textContent = 'Bonus waktu: +5';
  nextQuestionBtn.innerHTML = `
    <div class="flex items-center">
      <span>Selanjutnya</span>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </div>
  `;
  
  // Switch back to quiz screen
  resultsScreen.classList.add('hidden');
  quizScreen.classList.remove('hidden');
  
  // Load first question
  loadQuestion();
}

// Update the shareResults function to improve WhatsApp sharing
function shareResults() {
  // Get player name (or use default)
  const displayName = playerName || "Saya";
  
  // Calculate correct answers
  const totalCorrect = answeredQuestions.reduce((count, answered, index) => {
    if (answered && quizData[index].correctAnswer === userAnswers[index]) {
      return count + 1;
    }
    return count;
  }, 0);
  
  // Create share text with more details
  const text = `${displayName} mendapatkan skor ${score}/100 dalam Quiz Pengetahuan Haji! (${totalCorrect} jawaban benar dari ${quizData.length} pertanyaan). Coba tantang diri Anda!`;
  
  // Create a modal for sharing options
  const shareModal = document.createElement('div');
  shareModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
  shareModal.innerHTML = `
    <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Bagikan Hasil</h3>
      <p class="text-gray-600 mb-4">${text}</p>
      
      <div class="grid grid-cols-1 gap-3 mb-4">
        <button id="copy-text" class="bg-primary-50 hover:bg-primary-100 text-primary-700 font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
          </svg>
          Salin Teks
        </button>
        <button id="share-wa" class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
          </svg>
          Bagikan ke WhatsApp
        </button>
      </div>
      
      <div class="flex justify-end">
        <button id="close-share-modal" class="text-gray-500 hover:text-gray-700 font-medium">
          Tutup
        </button>
      </div>
    </div>
  `;
  
  document.body.appendChild(shareModal);
  
  // Add event listeners to the modal buttons
  document.getElementById('copy-text').addEventListener('click', () => {
    copyTextToClipboard(text);
    showToast('Teks berhasil disalin!');
  });
  
  document.getElementById('share-wa').addEventListener('click', () => {
    const encodedText = encodeURIComponent(text);
    window.open(`https://wa.me/?text=${encodedText}`, '_blank');
  });
  
  document.getElementById('close-share-modal').addEventListener('click', () => {
    document.body.removeChild(shareModal);
  });
}

  // Add these helper functions after the shareResults function:

  // Copy text to clipboard
  function copyTextToClipboard(text) {
    // Create temporary input
    const input = document.createElement('textarea');
    input.value = text;
    document.body.appendChild(input);
    
    // Select and copy
    input.select();
    document.execCommand('copy');
    document.body.removeChild(input);
  }

  // Show toast notification
  function showToast(message) {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg';
    toast.textContent = message;
    
    // Add to document
    document.body.appendChild(toast);
    
    // Remove after 3 seconds
    setTimeout(() => {
      toast.classList.add('opacity-0', 'transition-opacity', 'duration-500');
      setTimeout(() => {
        document.body.removeChild(toast);
      }, 500);
    }, 3000);
  }

  // Remove the old fallbackShare function since we've replaced it with better options
    
    // Add event listeners
    startQuizBtn.addEventListener('click', startQuiz);
    nextQuestionBtn.addEventListener('click', goToNextQuestion);
    prevQuestionBtn.addEventListener('click', goToPrevQuestion);
    retryQuizBtn.addEventListener('click', resetQuiz);
    shareResultsBtn.addEventListener('click', shareResults);
  });
</script>
